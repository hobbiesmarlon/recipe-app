<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Instructions — Cleaned</title>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&family=Noto+Sans:wght@400;500;700;900&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#ec6d13",
            "background-light": "#f8f7f6",
            "background-dark": "#221810",
          },
          fontFamily: { display: ["Plus Jakarta Sans"] },
          borderRadius: { DEFAULT: "0.25rem", lg: "0.5rem", xl: "0.75rem", full: "9999px" },
        },
      },
    };
  </script>
  <style>
    body { min-height: max(884px, 100dvh); }
  </style>
  <link rel="stylesheet" href="../shared.css" />
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
  <div class="flex h-screen flex-col">
    <header class="flex items-center justify-between border-b border-primary/20 bg-background-light px-4 py-3 dark:bg-background-dark">
      <a href="recipe-ingredients.html" class="flex items-center justify-center text-primary" aria-label="Back">
        <span class="material-symbols-outlined text-3xl"> arrow_back </span>
      </a>
      <h1 class="text-lg font-bold text-background-dark dark:text-background-light">Add Instructions</h1>
      <div class="w-8"></div>
    </header>
    <!-- Page Indicators (4 steps) -->
    <div class="flex w-full flex-row items-center justify-center gap-3 py-4" role="progressbar" aria-label="Step progress" aria-valuemin="1" aria-valuemax="4" aria-valuenow="3">
      <div class="h-2 w-2 rounded-full progress-dot" aria-hidden="true"></div>
      <div class="h-2 w-2 rounded-full progress-dot" aria-hidden="true"></div>
      <div class="h-2 w-2 rounded-full progress-dot progress-dot--active" aria-hidden="true"></div>
      <div class="h-2 w-2 rounded-full progress-dot" aria-hidden="true"></div>
    </div>

    <main class="flex-1 overflow-y-auto bg-background-light px-4 pt-4 dark:bg-background-dark">
      <div class="mx-auto max-w-2xl">
      <ul id="steps-list" class="space-y-4 pb-20" aria-live="polite"></ul>

      <!-- Single add-step-wrapper used across layouts -->
      <div class="add-step-wrapper mt-4">
        <!-- Styled like Add Ingredient: full-width, h-14, muted primary background -->
        <button class="add-step-button flex h-14 w-full items-center justify-center gap-2 rounded-lg bg-primary/20 text-primary transition-colors hover:bg-primary/30 dark:bg-primary/30 dark:hover:bg-primary/40" type="button">
          <span class="material-symbols-outlined">add</span>
          <span class="font-bold">Add Step</span>
        </button>

        <div class="step-input hidden mt-3">
          <textarea class="step-textarea w-full rounded-md border-gray-300 text-base text-background-dark focus:border-primary focus:ring-primary dark:bg-background-dark dark:text-background-light" placeholder="Enter step description..." rows="3"></textarea>
          <div class="mt-2 flex justify-end gap-2">
            <button class="cancel-step rounded-lg px-4 py-2 text-primary hover:bg-primary/10 dark:hover:bg-primary/20" type="button">Cancel</button>
            <button class="confirm-add-step rounded-lg bg-primary px-4 py-2 text-white hover:bg-primary-dark" type="button">Add Step</button>
          </div>
        </div>
      </div>
    </main>

  </div>
   <footer class="fixed bottom-0 left-0 right-0 z-10 bg-background-light dark:bg-background-dark p-4 border-t border-border-light dark:border-border-dark">
    <div class="mx-auto max-w-2xl">
      <a href="recipe-categories.html" class="h-12 w-full rounded-full bg-primary text-white font-bold text-base leading-normal flex items-center justify-center gap-2">Next Step <span class="material-symbols-outlined text-base">arrow_forward</span></a>
    </div>
  </footer>
  </div>

  <script>
    // initial steps data (could come from server or previous steps)
    const steps = [
      'Preheat oven to 350°F (175°C).',
      'In a large bowl, cream together the butter and sugar until smooth.',
      'Beat in the eggs one at a time, then stir in the vanilla.'
    ];

    const stepsList = document.getElementById('steps-list');

    function renderSteps() {
      stepsList.innerHTML = steps.map((text, i) => {
        return `
          <li class="flex items-center justify-between rounded-xl bg-white p-5 shadow-lg dark:bg-black/20" data-index="${i}">
            <div class="flex items-start gap-3 flex-1">
              <button aria-label="drag" class="text-background-dark/60 hover:text-primary dark:text-background-light/60">
                <span class="material-symbols-outlined text-3xl">drag_indicator</span>
              </button>
              <div class="flex-1">
                <p class="text-lg font-bold text-background-dark dark:text-background-light">Step ${i+1}</p>
                <p class="text-base text-background-dark/80 dark:text-background-light/80 mt-1">${escapeHtml(text)}</p>
              </div>
            </div>
            <div class="flex items-center gap-2 ml-4">
              <button aria-label="edit" class="flex h-8 w-8 items-center justify-center rounded-full text-background-dark/60 hover:text-primary dark:text-background-light/60">
                <span class="material-symbols-outlined text-base">edit</span>
              </button>
              <button aria-label="delete" class="flex h-8 w-8 items-center justify-center rounded-full text-background-dark/60 hover:text-primary dark:text-background-light/60">
                <span class="material-symbols-outlined text-base">delete</span>
              </button>
            </div>
          </li>
        `;
      }).join('');
    }

    // minimal HTML escaping
    function escapeHtml(s) {
      return s.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;');
    }

    renderSteps();

    // add-step behaviour (single wrapper)
    document.querySelectorAll('.add-step-wrapper').forEach(wrapper => {
      const addButton = wrapper.querySelector('.add-step-button');
      const stepInput = wrapper.querySelector('.step-input');
      const textarea = wrapper.querySelector('.step-textarea');
      const cancelButton = wrapper.querySelector('.cancel-step');
      const confirmButton = wrapper.querySelector('.confirm-add-step');

      addButton.addEventListener('click', () => {
        addButton.classList.add('hidden');
        stepInput.classList.remove('hidden');
        stepInput.classList.add('flex');
        textarea.value = '';
        textarea.focus();
      });

      cancelButton.addEventListener('click', () => {
        addButton.classList.remove('hidden');
        stepInput.classList.add('hidden');
        stepInput.classList.remove('flex');
        textarea.value = '';
      });

      confirmButton.addEventListener('click', () => {
        const val = textarea.value.trim();
        if (!val) return textarea.focus();
        steps.push(val);
        renderSteps();
        // Reset UI
        addButton.classList.remove('hidden');
        stepInput.classList.add('hidden');
        stepInput.classList.remove('flex');
        textarea.value = '';
      });
    });

    // expose for debugging
    window.__recipeSteps = steps;
  </script>
</body>
</html>
